<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.18.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Lidar and SfM Point Cloud Python KDTree Comparison - VACON</title>
<meta name="description" content="This short entry describes a comparison of KDTree implementations for Lidar PointClouds (PC) and Structure-from-Motion (SfM) dataset.  ">


  <meta name="author" content="Bodo Bookhagen">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="VACON">
<meta property="og:title" content="Lidar and SfM Point Cloud Python KDTree Comparison">
<meta property="og:url" content="http://localhost:4000/KDTree-comparison_I/">


  <meta property="og:description" content="This short entry describes a comparison of KDTree implementations for Lidar PointClouds (PC) and Structure-from-Motion (SfM) dataset.  ">







  <meta property="article:published_time" content="2020-10-20T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/KDTree-comparison_I/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Remote Sensing and Earth Surface Processes",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="VACON Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



<!-- Mathjax Support -->
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          VACON
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/team_members/">Team</a>
            </li><li class="masthead__menu-item">
              <a href="/publications/">Publications</a>
            </li><li class="masthead__menu-item">
              <a href="/theses/">BSc and MSc Theses</a>
            </li><li class="masthead__menu-item">
              <a href="/msc-rsiv/">MSc RSIV</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Blog Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/codes/">Codes</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/images/bookhagen.jpg" alt="Bodo Bookhagen" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Bodo Bookhagen</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Research and Teaching in Remote Sensing and Earth Surface Process</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">University of Potsdam</span>
        </li>
      

      
        
          
            <li><a href="mailto:bodo.bookhagen@uni-potsdam.de" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
          
        
          
            <li><a href="https://bodobookhagen.github.io/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Website</a></li>
          
        
          
            <li><a href="https://twitter.com/RemotesensingUp" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
          
        
          
            <li><a href="https://github.com/UP-RS-ESP" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
          
        
          
            <li><a href="https://www.instagram.com/bodobookhagen/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
          
        
      

      

      
        <li>
          <a href="mailto:bodo.bookhagen@uni-potsdam.de">
            <meta itemprop="email" content="bodo.bookhagen@uni-potsdam.de" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Lidar and SfM Point Cloud Python KDTree Comparison">
    <meta itemprop="description" content="This short entry describes a comparison of KDTree implementations for Lidar PointClouds (PC) and Structure-from-Motion (SfM) dataset.">
    <meta itemprop="datePublished" content="2020-10-20T00:00:00+02:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Lidar and SfM Point Cloud Python KDTree Comparison
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> PC-KDTree</h4></header>
              <ul class="toc__menu">
  <li><a href="#kdtree-and-knn-algorithms">KDTree and KNN Algorithms</a></li>
  <li><a href="#method-and-approach">Method and Approach</a></li>
  <li><a href="#datasets">Datasets</a>
    <ul>
      <li><a href="#subset-of-pozo-catchment-airborne-lidar-data-from-santa-cruz-island-california">Subset of Pozo catchment: Airborne Lidar data from Santa Cruz Island, California</a></li>
    </ul>
  </li>
  <li><a href="#summary-of-results-for-the-pozo-catchment-n3348668-points">Summary of Results for the Pozo catchment (n=3,348,668 points)</a></li>
</ul>

            </nav>
          </aside>
        
        <p>This short entry describes a comparison of KDTree implementations for Lidar PointClouds (PC) and Structure-from-Motion (SfM) dataset.</p>

<p>A more detailed analysis is found on <strong><a href="">Comparing Python KD-Tree Implementations with Focus on Point Cloud Processing</a></strong> and the github repository <strong><a href="https://github.com/UP-RS-ESP/LidarPC-KDTree">LidarPC-KDTree</a></strong>.</p>

<h1 id="kdtree-and-knn-algorithms">KDTree and KNN Algorithms</h1>
<p>One of the core processing steps for irregular PC is to understand the neighborhood for each point (kNN - k-Nearest-Neighbors). This is often done using <a href="https://en.wikipedia.org/wiki/K-d_tree">KD Trees</a>. There exist myriad of implementations for various applications and KD Trees have become an important tool for Deep Learning that have been implemented in <a href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm">kNN (k-nearest neighbor)</a> algorithms. Many of the approaches have been optimized for multi-dimensional datasets (n&gt;5 and up to 50). In the recent months and years, KD-Trees relying on <a href="https://en.wikipedia.org/wiki/CUDA">CUDA</a> or <a href="https://en.wikipedia.org/wiki/OpenCL">OpenCL</a> implementations have become more coming and easily approachable through Python or Matlab interfaces.</p>

<p><strong>Here, we briefly explore existing algorithms and test, which one perform favorable for 3D lidar PC (or SfM PC). We only use three dimensions (x, y, z), but future implementation may rely on four (intensity) or higher dimensional lidar PC. We focus on implementations accessible through Python or C.</strong></p>

<p>We note that there exist other algorithm and parameter comparisons (e.g. <a href="https://jakevdp.github.io/blog/2013/04/29/benchmarking-nearest-neighbor-searches-in-python/">knn-benchmarking in python</a> and <a href="http://mccormickml.com/2017/09/08/knn-benchmarks-part-1/">knn-benchmarking</a>) and these are very useful and helpful – but these are neither tailored for lidar/SfM PC nor have been using recent implementations. Most comparison also focus on the general applicability of KD-Tree algorithm and explore the impact of leaf sizes and dimensionality - both parameters do not change for lidar PC.</p>

<h1 id="method-and-approach">Method and Approach</h1>
<p>We construct the following scenarios:</p>
<ol>
  <li>Deriving k=5,10,50,100,500,1000 nearest neighbors from four lidar/SfM point clouds with 14e6, 38e6, 69e6, and 232e6 (million) points.</li>
  <li>We time the generation of a KD-Tree and the queries separately for each.</li>
  <li>Searching for neighbors within a given search radius/sphere (not supported by all algorithms).</li>
  <li>The k-nearest neighbors can be used to estimate point-density or perform further classification on the neighborhood structure of points (e.g., curvature)</li>
  <li>We compare approaches for three computing setups: (1) AMD Ryzen 3900X (3.8 GHz, 12 cores); (2) AMD Ryzen 2970WX (2.9 GHz, 24 cores); (3) Intel Xeon Gold 6230 CPU (2.10 GHz, 2x20 cores)</li>
</ol>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Name</th>
      <th style="text-align: left">Reference and Documentation</th>
      <th style="text-align: left">Comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">scipy.spatial.KDTree</td>
      <td style="text-align: left"><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.KDTree.html#scipy.spatial.KDTree">Manual</a></td>
      <td style="text-align: left">Pure Python implementation of KD tree. Querying is very slow and usage is not suggested. Not used.<em>Single core CPU processing.</em></td>
    </tr>
    <tr>
      <td style="text-align: left">scipy.spatial.cKDTree</td>
      <td style="text-align: left"><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.spatial.cKDTree.html#scipy.spatial.cKDTree">Manual</a></td>
      <td style="text-align: left">KDTree implementation in Cython. <em>Single and Multi-core CPU processing.</em></td>
    </tr>
    <tr>
      <td style="text-align: left">sklearn.neighbors.KDTree</td>
      <td style="text-align: left"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KDTree.html">Manual</a></td>
      <td style="text-align: left">KDTree implementation in sklearn. <em>Single core CPU processing.</em></td>
    </tr>
    <tr>
      <td style="text-align: left">pyKDTree</td>
      <td style="text-align: left"><a href="https://github.com/storpipfugl/pykdtree">github page</a> and <a href="https://pypi.org/project/pykdtree/#description">pypi project page</a></td>
      <td style="text-align: left">fast implementation for common use cases (low dimensions and low number of neighbours) for both tree construction and queries. The implementation is based on scipy.spatial.cKDTree and libANN by combining the best features from both and focus on implementation efficiency. <em>Multi-core CPU processing.</em></td>
    </tr>
    <tr>
      <td style="text-align: left">pyflann</td>
      <td style="text-align: left"><a href="https://github.com/primetang/pyflann">github</a></td>
      <td style="text-align: left">pyflann is the python bindings for <a href="http://www.cs.ubc.ca/research/flann/">FLANN - Fast Library for Approximate Nearest Neighbors</a> and <a href="https://www.cs.ubc.ca/research/flann/uploads/FLANN/flann_manual-1.8.4.pdf">FLANN Manual 1.8.4</a> <em>Multi-core CPU processing.</em></td>
    </tr>
    <tr>
      <td style="text-align: left">cyflann</td>
      <td style="text-align: left"><a href="https://github.com/dougalsutherland/cyflann">github</a></td>
      <td style="text-align: left">cyflann is the a cython interface for <a href="http://www.cs.ubc.ca/research/flann/">FLANN - Fast Library for Approximate Nearest Neighbors</a> and <a href="https://www.cs.ubc.ca/research/flann/uploads/FLANN/flann_manual-1.8.4.pdf">FLANN Manual 1.8.4</a>. <em>Multi-core CPU processing.</em></td>
    </tr>
    <tr>
      <td style="text-align: left">NearestNeighbors</td>
      <td style="text-align: left"><a href="https://docs.rapids.ai/api/cuml/nightly/api.html#nearest-neighbors">cuml-kNN</a></td>
      <td style="text-align: left">GPU implementaiton of knn via <a href="https://github.com/rapidsai">rapidsai</a>, <em>currently only supports brute-force algorithm and is not competitive</em></td>
    </tr>
  </tbody>
</table>

<h1 id="datasets">Datasets</h1>
<h2 id="subset-of-pozo-catchment-airborne-lidar-data-from-santa-cruz-island-california">Subset of Pozo catchment: Airborne Lidar data from Santa Cruz Island, California</h2>
<p>The airborne point cloud from Santa Cruz Island, California represents a natural terrain without buildings, but lower density. The  dataset contains 3,348,668 points with a point-density of 7.2 pts/m^2 and has been ground-classified using <a href="https://rapidlasso.com/lastools/">LAStools</a>. The points have been colored using an airphoto from the same time as the lidar flight.
The test area is from a small subset of the Pozo catchment in the southwestern part of the island. These data are openly accessibly and available from <a href="https://opentopography.org/">opentopography</a> and were originally acquired by the USGS in 2010. The geologic and geomorphic environment and setting of the Santa Cruz Island has been described in several peer-reviewed scientific publications (e.g., <a href="https://doi.org/10.1016/j.geomorph.2010.01.009">Perroy et al., 2010</a>,  <a href="https://doi.org/10.1080/00045608.2012.715054">Perroy et al., 2012</a>, <a href="https://doi.org/10.1002/2017JF004250">Neely et al., 2017</a>, <a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2018JF004827">Rheinwalt et al., 2019</a>, <a href="https://doi.org/10.1029/2019JF005025">Clubb et al., 2019</a>).</p>

<h1 id="summary-of-results-for-the-pozo-catchment-n3348668-points">Summary of Results for the Pozo catchment (n=3,348,668 points)</h1>
<p>We ran tests on a AMD Ryzen Threadripper 2970WX 24-Core Processor (2019) with a NVIDIA Titan RTX 24 GB running Ubuntu 18.04 (CUDA 10.1) and a AMD Ryzen 9 3900X 12-Core Processor with a NVIDIA GeForce RTX 2080 SUPER running Ubuntu 20.04 (CUDA 11.0).</p>

<p>A first test using standard single-core and multi core algorithms for n=3,348,668 queries for n=3,348,668 points. Note that the KDTree calculations from <em>scipy.spatial.KDTree</em> have note been included, because they were too slow. Also, for the single core <em>sklearnKDTree</em> approach, no higher number of neighbors have been included (too slow). All results show times in seconds (s) and have been averaged over n=3 runs.</p>

<p>Comparing the traditional and widely used <em>sklearnKDTree</em> (single core) and <em>cKDTree</em> (multi core) approaches we note the following results:</p>
<ol>
  <li>The <strong>leaf size</strong> is an important parameter to speed up single-core querying trees. Depending on point cloud structure, different leaf sizes provide very different results and can improve query times. We note that the default leaf size does not generate useful results for real-world airborne lidar data and that there exists a minimum time representing an optimal leaf size.</li>
  <li>The <em>sklearnKDTree</em> (single core) is slow on these massive queries. The option <code class="language-plaintext highlighter-rouge">dualtree=True</code> has been used to speed up processing.</li>
  <li><strong><em>cKDtree</em> with <code class="language-plaintext highlighter-rouge">jobs=-1</code> set for querying outperforms single-core approaches</strong> - especially on modern multi-core systems. Leaf size does not have a significant impact on multi-core processing, but some for larger neighborhood queries (k&gt;100).</li>
  <li>There are minimal difference between different approach. For example. the max. difference between <em>sklearnKDTree</em> and <em>cKDTree</em> is 0.2m and the median difference is 0.0.</li>
  <li>Comparing <em>cKDTree</em> with 12, 24, and 48 core processors <strong>indicates a clear advantage of multi-threading systems</strong>. We emphasize that in order to take full advantage of multi-threading processes, an increase in available DRAM is needed (i.e., more cores require more DRAM). We note that <em>pyKDTree</em> has lower peak memory requirement than <em>cKDTree</em>.</li>
  <li>The FLANN (Fast Library for Approximate Nearest Neighbors) family of approaches provides additional advancements, especially for large datasets and massive queries.</li>
  <li>Initial tests with cuML (CUDA RAPIDS) show that the implemented brute-force approach for nearest neighbor searches is not competitive against the multi-core approaches (<em>cKDTree</em> and <em>pyKDTree</em>) and highly optimized FLANN approaches. But there are other processing advantages of data analysis using  CUDA Dataframes (cudf).</li>
</ol>

<figure>
    <a href="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_sklearnKDTree_AMD3900X_12cores.png"><img src="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_sklearnKDTree_AMD3900X_12cores.png" /></a>
    <figcaption>Generation and query times for single-core sklearnKDTree for varying leafsizes.</figcaption>
</figure>

<figure>
    <a href="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_cKDTree_AMD3900X_12cores.png"><img src="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_cKDTree_AMD3900X_12cores.png" /></a>
    <figcaption>The multi-core cKDTree implementation in scipy.spatial.cKDTree performs well - but you need to set the 'jobs=-1' parameter in the query to achieve best results and use all available cores (only during queries).</figcaption>
</figure>

<figure>
    <a href="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_ckDTree_pyKDTree_k5_to_k1000_vcores_leafsize20.png"><img src="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_ckDTree_pyKDTree_k5_to_k1000_vcores_leafsize20.png" /></a>
    <figcaption>Comparison of pyKDTree and cKDTree for different number of cores (both use a leaf size of 20). cKDTree outperforms pyKDTree and shows a nearly linear rise in time for increasing values in k-nearest neighbors. Higher number of cores result in faster processing time, most notably at higher number of ks. Processing times for lower k are faster for higher CPU speeds (3.9 GHz vs. 2.1 GHz).</figcaption>
</figure>

<figure>
    <a href="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_ckDTree_cyfFLANN_k5_to_k1000_vcores_leafsize20.png"><img src="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/pc_ckDTree_cyfFLANN_k5_to_k1000_vcores_leafsize20.png" /></a>
    <figcaption>Comparison of cyFLANN and cKDTree. With higher number of cores, cKDTree performs better than cyFLANN for large number of neighbors. cyFLANN performs better for lower number of neighbors (small k) (a factor of 2 at k=500 neighbors with 40 cores).</figcaption>
</figure>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Algorithm</th>
      <th style="text-align: right">Generate KDTree (s)</th>
      <th style="text-align: right">Query k=5 (s)</th>
      <th style="text-align: right">Query k=10 (s)</th>
      <th style="text-align: right">Query k=50 (s)</th>
      <th style="text-align: right">Query k=100 (s)</th>
      <th style="text-align: right">Query k=500 (s)</th>
      <th style="text-align: right">Query k=1000 (s)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">KDTree</td>
      <td style="text-align: right">5.25</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
    </tr>
    <tr>
      <td style="text-align: left">sklearnKDTree</td>
      <td style="text-align: right">1.51</td>
      <td style="text-align: right">36.93</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
      <td style="text-align: right">nan</td>
    </tr>
    <tr>
      <td style="text-align: left"><strong>cKDTree</strong></td>
      <td style="text-align: right">0.32</td>
      <td style="text-align: right">0.23</td>
      <td style="text-align: right">0.31</td>
      <td style="text-align: right">0.91</td>
      <td style="text-align: right">1.67</td>
      <td style="text-align: right">7.47</td>
      <td style="text-align: right">15.13</td>
    </tr>
    <tr>
      <td style="text-align: left">pyKDTree</td>
      <td style="text-align: right">0.07</td>
      <td style="text-align: right">0.23</td>
      <td style="text-align: right">0.32</td>
      <td style="text-align: right">1.1</td>
      <td style="text-align: right">2.58</td>
      <td style="text-align: right">35.17</td>
      <td style="text-align: right">129.81</td>
    </tr>
    <tr>
      <td style="text-align: left">pyflannKDTree</td>
      <td style="text-align: right">0.19</td>
      <td style="text-align: right">0.17</td>
      <td style="text-align: right">0.24</td>
      <td style="text-align: right">0.97</td>
      <td style="text-align: right">2.11</td>
      <td style="text-align: right">12.54</td>
      <td style="text-align: right">27.4</td>
    </tr>
    <tr>
      <td style="text-align: left">cyflannKDTree</td>
      <td style="text-align: right">0.26</td>
      <td style="text-align: right">0.2</td>
      <td style="text-align: right">0.26</td>
      <td style="text-align: right">1</td>
      <td style="text-align: right">2.2</td>
      <td style="text-align: right">9.69</td>
      <td style="text-align: right">20.01</td>
    </tr>
  </tbody>
</table>

<p>Table: Comparison of fastest processing times (any leaf size) for all implemented algorithms in seconds. Note that scipy standard <em>KDTree</em> has not been processed due to the very slow processing times. All times are the average of 3 iterations.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Algorithm</th>
      <th style="text-align: right">Generate KDTree (leaf size)</th>
      <th style="text-align: right">Query k=5 (leaf size)</th>
      <th style="text-align: right">Query k=10 (leaf size)</th>
      <th style="text-align: right">Query k=50 (leaf size)</th>
      <th style="text-align: right">Query k=100 (leaf size)</th>
      <th style="text-align: right">Query k=500 (leaf size)</th>
      <th style="text-align: right">Query k=1000 (leaf size)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">KDTree</td>
      <td style="text-align: right">10</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">cKDTree</td>
      <td style="text-align: right">36</td>
      <td style="text-align: right">14</td>
      <td style="text-align: right">16</td>
      <td style="text-align: right">24</td>
      <td style="text-align: right">14</td>
      <td style="text-align: right">38</td>
      <td style="text-align: right">38</td>
    </tr>
    <tr>
      <td style="text-align: left">sklearnKDTree</td>
      <td style="text-align: right">28</td>
      <td style="text-align: right">12</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">pyKDTree</td>
      <td style="text-align: right">36</td>
      <td style="text-align: right">16</td>
      <td style="text-align: right">20</td>
      <td style="text-align: right">16</td>
      <td style="text-align: right">28</td>
      <td style="text-align: right">26</td>
      <td style="text-align: right">32</td>
    </tr>
  </tbody>
</table>

<p>Table: Best leaf sizes (fastest times). Note the differences for varying numbers of neighbors.</p>

<figure>
    <a href="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/Pozo_WestCanada_clg.png"><img src="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/Pozo_WestCanada_clg.png" /></a>
    <figcaption>Create and query cKDTree for three k neighbors and leaf sizes. Creating the cKDTree does not show large variability, but querying is mostly dependent on number of k neighbors. </figcaption>
</figure>

<figure>
    <a href="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/Pozo_WestCanada_clg_jobs.png"><img src="https://github.com/UP-RS-ESP/LidarPC-KDTree/raw/master/docs/figs/Pozo_WestCanada_clg_jobs.png" /></a>
    <figcaption>Create and query cKDTree for using 1 to 8 threads. Generating the cKDTree only slightly improves when increasing numbers of threads, but querying significantly improves for higher number threads. </figcaption>
</figure>

<script type="text/javascript"> DiscourseEmbed = { discourseUrl: 'https://discourse.up-rs-esp-3.geo.uni-potsdam.de/', discourseEmbedUrl: 'https://up-rs-esp.github.io//KDTree-comparison_I/' };
(function() { var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true; d.src = DiscourseEmbed.discourseUrl + 'javascripts/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d); })(); </script>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#android" class="page__taxonomy-item" rel="tag">Android</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#annotating" class="page__taxonomy-item" rel="tag">Annotating</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#galaxy" class="page__taxonomy-item" rel="tag">Galaxy</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ipad" class="page__taxonomy-item" rel="tag">iPad</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#pdf" class="page__taxonomy-item" rel="tag">PDF</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#teaching" class="page__taxonomy-item" rel="tag">teaching</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ubuntu" class="page__taxonomy-item" rel="tag">Ubuntu</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#whiteboard" class="page__taxonomy-item" rel="tag">Whiteboard</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-10-20T00:00:00+02:00">October 20, 2020</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Lidar+and+SfM+Point+Cloud+Python+KDTree+Comparison%20http%3A%2F%2Flocalhost%3A4000%2FKDTree-comparison_I%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2FKDTree-comparison_I%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2FKDTree-comparison_I%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/posts/2020/10/RAPIDS-install-ubuntu/" class="pagination--pager" title="RAPIDS.AI Install on Ubuntu
">Previous</a>
    
    
      <a href="/Android-as-Whiteboard_I/" class="pagination--pager" title="Using an iPad or Samsung Galaxy with Android as Whiteboard
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/CameraCalibration1_calibio/" rel="permalink">Camera Calibration (1): Comparison of boards and parameters with calib.io
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Precise Camera Calibration is an important part of generating high-quality points clouds and mesh models. We outline some basic procedures to generate reliab...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/VCM03-DavidHersh/" rel="permalink">Apple segmentation in 3D point clouds
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">This internship aimed at segmenting apples from a high-resolution Terrestrial Lidar Scan (TLS) Point Cloud with a simple clustering approach and a deep learn...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/ManTuenChan_UNET_pebble_segmentation/" rel="permalink">A U-Net-SegmentAnything 2-pass approach with stereo-depth sensing for river-pebble panoptic segmentation
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Introduction
Sediment charateristics and grain-size distribution carries important information on the drainage system, the ecosystem, and the weather conditi...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Kathmandu_Workshop_Feb2024/" rel="permalink">Climate Data Collection and Analysis, Kathmandu, Feb 26-27 2024
</a>
      
    </h2>
    
    <p class="archive__item-excerpt" itemprop="description">Workshop organized and led by Dr Taylor Smith (University of Potsdam, Germany), Dr Bodo Bookhagen (University of Potsdam, Germany) and Dr Shakil Regmi (South...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
          <li><a href="https://github.com/UP-RS-ESP" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://gitup.uni-potsdam.de/RS-ESP" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-gitlab" aria-hidden="true"></i> GitLab</a></li>
        
      
        
      
        
      
    

    <li><a href="https://www.uni-potsdam.de/de/datenschutzerklaerung.html">Datenschutzerklärung (German)</a></li>
    <li><a href="https://www.uni-potsdam.de/en/data-protection-declaration.html">Data Protection Declaration (Englisch)</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 Remote Sensing and Earth Surface Processes. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







    

  





  </body>
</html>
